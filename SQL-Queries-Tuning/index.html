<h1 id="documentation-sql-query-optimization">Documentation: SQL Query Optimization</h1>
<p>SQL query optimization is an essential process for improving database performance, ensuring more efficient query execution and resource usage. This document presents fundamental concepts, practical techniques, and examples for SQL query optimization.</p>

<hr />

<h2 id="1-fundamentals-of-sql-query-optimization">1. Fundamentals of SQL Query Optimization</h2>

<h3 id="11-what-is-sql-tuning">1.1 What is SQL Tuning?</h3>
<p>SQL Tuning refers to the process of optimizing queries to improve database performance. The main objectives are:</p>
<ul>
  <li>Reduce query execution time.</li>
  <li>Minimize resource consumption.</li>
  <li>Improve end-user experience.</li>
</ul>

<h3 id="12-main-causes-of-slow-queries">1.2 Main Causes of Slow Queries</h3>
<ul>
  <li>Retrieving excessive amounts of data.</li>
  <li>Lack of optimized indexes.</li>
  <li>Improper use of joins and subqueries.</li>
  <li>Inefficient filtering (WHERE, LIMIT, etc.).</li>
</ul>

<hr />

<h2 id="2-identifying-bottlenecks">2. Identifying Bottlenecks</h2>

<h3 id="21-using-explain">2.1 Using EXPLAIN</h3>
<p>The <code class="language-plaintext highlighter-rouge">EXPLAIN</code> command allows you to visualize how an SQL query will be executed, helping to identify bottlenecks and optimization opportunities.</p>

<h4 id="example-of-using-explain">Example of using EXPLAIN:</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">EXPLAIN</span> <span class="k">ANALYZE</span> <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">customers</span> <span class="k">WHERE</span> <span class="n">country</span> <span class="o">=</span> <span class="s1">'Brazil'</span><span class="p">;</span>
</code></pre></div></div>

<p>This command returns information about the query execution plan, including:</p>
<ul>
  <li>Search strategy (Index Scan, Sequential Scan, etc.).</li>
  <li>Estimated execution cost.</li>
  <li>Number of rows processed.</li>
</ul>

<h3 id="22-using-indexes">2.2 Using Indexes</h3>
<p>Indexes speed up data retrieval by avoiding unnecessary sequential scans. Different types of indexes include:</p>

<ul>
  <li><strong>B-Tree Index</strong>: Most common, used for columns with ordered values.</li>
  <li><strong>Full-Text Index</strong>: Optimizes searches in large text volumes.</li>
  <li><strong>Hash Index</strong>: Ideal for exact searches.</li>
</ul>

<h4 id="example-of-creating-an-index">Example of creating an index:</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_customers_country</span> <span class="k">ON</span> <span class="n">customers</span> <span class="p">(</span><span class="n">country</span><span class="p">);</span>
</code></pre></div></div>

<p>This index improves queries filtering by the <code class="language-plaintext highlighter-rouge">country</code> column.</p>

<hr />

<h2 id="3-best-practices-for-optimization">3. Best Practices for Optimization</h2>

<h3 id="31-avoid-select-">3.1 Avoid <code class="language-plaintext highlighter-rouge">SELECT *</code></h3>
<p><code class="language-plaintext highlighter-rouge">SELECT *</code> retrieves all table columns, consuming more resources than necessary.</p>

<h4 id="optimized-alternative">Optimized alternative:</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">customers</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="32-use-where-for-filtering">3.2 Use WHERE for Filtering</h3>
<p>Using filters reduces the number of processed records, improving performance.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">customers</span> <span class="k">WHERE</span> <span class="n">country</span> <span class="o">=</span> <span class="s1">'Brazil'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="33-prefer-joins-over-subqueries">3.3 Prefer JOINs Over Subqueries</h3>
<p>Subqueries are less efficient and can be replaced by <code class="language-plaintext highlighter-rouge">JOINs</code>.</p>

<h4 id="example-with-subquery-less-efficient">Example with subquery (less efficient):</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">orders</span> <span class="k">WHERE</span> <span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_spent</span>
<span class="k">FROM</span> <span class="n">customers</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="optimized-example-with-join">Optimized example with JOIN:</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">customers</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_spent</span>
<span class="k">FROM</span> <span class="n">customers</span>
<span class="k">JOIN</span> <span class="n">orders</span> <span class="k">ON</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">customers</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="34-avoid-functions-on-indexed-columns">3.4 Avoid Functions on Indexed Columns</h3>
<p>Functions applied directly to indexed columns can invalidate the use of the index.</p>

<h4 id="inefficient-example">Inefficient example:</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">customers</span> <span class="k">WHERE</span> <span class="k">UPPER</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'JOHN DOE'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="optimized-alternative-1">Optimized alternative:</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">customers</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'John Doe'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="35-avoid-excessive-indexes">3.5 Avoid Excessive Indexes</h3>
<p>While indexes optimize <code class="language-plaintext highlighter-rouge">SELECT</code> queries, too many indexes can negatively impact <code class="language-plaintext highlighter-rouge">INSERTs</code>, <code class="language-plaintext highlighter-rouge">UPDATEs</code>, and <code class="language-plaintext highlighter-rouge">DELETEs</code>, as the database needs to update the indexes with each data change.</p>

<hr />

<h2 id="4-final-considerations">4. Final Considerations</h2>

<h3 id="41-benefits-of-optimization">4.1 Benefits of Optimization</h3>
<ul>
  <li>Reduced response time.</li>
  <li>Lower computational resource usage.</li>
  <li>Better scalability for large data volumes.</li>
</ul>

<h3 id="42-recommended-tools">4.2 Recommended Tools</h3>
<ul>
  <li><strong>EXPLAIN ANALYZE</strong> (PostgreSQL, MySQL, SQL Server)</li>
  <li><strong>SQL Profiler</strong> (SQL Server)</li>
  <li><strong>Query Plan Visualization</strong> (PostgreSQL, MySQL)</li>
</ul>

<h3 id="43-additional-resources">4.3 Additional Resources</h3>
<ul>
  <li><a href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html">MySQL EXPLAIN Guide</a></li>
  <li><a href="https://www.postgresql.org/docs/current/using-explain.html">PostgreSQL Query Optimization</a></li>
  <li><a href="https://docs.microsoft.com/en-us/sql/relational-databases/indexes/indexes?view=sql-server-ver15">SQL Server Index Strategies</a></li>
</ul>

<hr />

<h2 id="5-practical-exercises">5. Practical Exercises</h2>

<ol>
  <li>Execute a <code class="language-plaintext highlighter-rouge">SELECT *</code> query on a table with many records and compare the execution time with a <code class="language-plaintext highlighter-rouge">SELECT</code> specifying columns.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">EXPLAIN ANALYZE</code> to check the impact of an index before and after its creation.</li>
  <li>Rewrite a query using a subquery to use a <code class="language-plaintext highlighter-rouge">JOIN</code> instead and compare performance.</li>
</ol>

<p>This documentation serves as a study guide and reference for SQL query optimization. Following these best practices will help improve database performance and application efficiency.</p>

<hr />

<p><strong>Author:</strong> Based on Dio’s mentorship on SQL query optimization.</p>

